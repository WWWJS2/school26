<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap');
    :root{
      --primary:#10b981;
      --secondary:#059669;
      --dark:#047857;
      --light:#d1fae5;
      --accent:#fbbf24;
      --lab-color:#8b5cf6;
      --lab-dark:#7c3aed;
      --lab-light:#ede9fe;
      --text:#0f172a;
      --gray:#475569;
      --container:94vw;
      --card-bg:#ffffff;
      --shadow:0 4px 12px rgba(16,185,129,.1);
    }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html, body{
      font-family:'Tajawal',sans-serif;
      background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 50%,#f0fdf4 100%);
      color:var(--text);
      line-height:1.65;
      min-height:100vh;
      overflow-x:hidden;
      font-size:16px;
    }

    /* ØªØ­Ø³ÙŠÙ† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª */
    textarea, .input, select{
      direction: rtl;
      text-align: right;
      unicode-bidi: plaintext;
    }

    .header-logo{
      background:#fff;
      position:sticky;
      top:0;
      z-index:1000;
      box-shadow:0 4px 12px rgba(16,185,129,.1);
      border-bottom:2px solid var(--light);
      padding:8px 0;
    }
    .header-logo .wrap{
      width:var(--container);
      max-width:1200px;
      margin:0 auto;
      padding:0 12px;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
    }
    .header-logo img{
      height:84px;
      width:auto;
      object-fit:contain;
    }
    .header-text{text-align:center;margin-top:10px;}
    .header-text h1{color:var(--dark);font-size:1.8rem;margin-bottom:5px;}
    .header-text p{color:var(--gray);font-size:1rem;}
    .quran-verse{margin-top:10px;font-size:1.1rem;font-weight:500;color:var(--dark);}

    nav{
      background:linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 15px 0;
      box-shadow: 0 4px 12px rgba(16,185,129,.2);
    }
    .nav-container{width:var(--container);max-width:1200px;margin:0 auto;padding:0 12px;}
    .nav-title{color:#fff;text-align:center;margin-bottom:15px;font-size:1.3rem;font-weight:700;}
    .cards-container{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
    }
    .card{
      background:var(--card-bg);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      transition:all .25s;
      cursor:pointer;
      border:1px solid rgba(0,0,0,.04);
      text-align:center;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
    }
    .card:hover{transform:translateY(-4px);box-shadow:0 10px 20px rgba(0,0,0,.15);}
    .card .icon{
      font-size:2.2rem;
      width:62px;height:62px;
      display:flex;align-items:center;justify-content:center;
      border-radius:999px;
      background:rgba(16,185,129,.08);
      color:var(--primary);
      margin-bottom:4px;
    }
    .card .title{font-size:1.05rem;font-weight:800;color:var(--dark);}
    .card .subtitle{font-size:.8rem;color:#6b7280;display:flex;flex-wrap:wrap;gap:6px;justify-content:center;}
    .card .subtitle span{
      background:#e5e7eb;
      padding:3px 9px;
      border-radius:999px;
      font-size:.75rem;
    }
    .card.featured{border-top:3px solid var(--accent);}
    .card.labs{border-top:3px solid var(--lab-color);}
    .card.labs .icon{background:rgba(139,92,246,.12);color:var(--lab-color);}

    #iframe-container{width:100%;height:80vh;display:none;margin-top:20px;padding:0 1rem;}
    #content-frame{width:100%;height:100%;border-radius:12px;box-shadow:var(--shadow);border:none;}

    #local-pages{width:100%;max-width:1200px;margin:20px auto 40px;padding:0 1rem 80px;display:none;}
    .card-page{
      background:linear-gradient(135deg,#ffffff 0%,#ecfdf5 100%);
      padding:22px;
      border-radius:18px;
      box-shadow:0 10px 30px rgba(15,118,110,.12);
    }
    .wait-intro,.lab-intro,.general-intro{
      text-align:center;
      color:var(--gray);
      font-size:.95rem;
      margin-bottom:18px;
    }

    .form{display:grid;gap:14px;}
    .grid-3{display:grid;grid-template-columns:1fr;gap:10px;}
    @media (min-width:768px){.grid-3{grid-template-columns:repeat(3,1fr);}}
    label{display:flex;flex-direction:column;gap:6px;color:var(--text);font-weight:600;font-size:.88rem;}
    .input,textarea,select{
      width:100%;
      padding:9px 11px;
      border-radius:10px;
      border:2px solid #bbf7d0;
      background:#fefdf9;
      font-family:'Tajawal',sans-serif;
      font-size:.95rem;
      transition:all .2s;
      color:var(--text);
    }
    textarea{min-height:90px;resize:vertical;white-space:pre-wrap;word-break:break-word;}
    .input:focus,textarea:focus,select:focus{
      outline:none;border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(16,185,129,.18);
      background:#fff;
    }
    .lab-form .input,.lab-form textarea{border-color:var(--lab-light);}
    .lab-form .input:focus,.lab-form textarea:focus{
      border-color:var(--lab-color);
      box-shadow:0 0 0 3px rgba(139,92,246,.18);
    }

    .actions{display:flex;flex-direction:column;gap:8px;margin-top:6px;}
    @media (min-width:768px){.actions{flex-direction:row;}}
    .btn{
      border:none;border-radius:14px;
      padding:9px 16px;font-weight:800;font-size:.9rem;
      cursor:pointer;
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;
      box-shadow:0 4px 15px rgba(16,185,129,.4);
      transition:all .2s;
      width:100%;text-align:center;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(16,185,129,.5);}
    .btn:active{transform:scale(.98);}
    .btn.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);box-shadow:0 4px 15px rgba(185,28,28,.4);}
    .lab-form .btn{
      background:linear-gradient(135deg,var(--lab-color),var(--lab-dark));
      box-shadow:0 4px 15px rgba(139,92,246,.4);
    }

    .table-wrap{
      margin-top:8px;border-radius:12px;overflow:hidden;
      box-shadow:0 6px 18px rgba(15,118,110,.12);
      overflow-x:auto;background:#fff;
    }
    table{width:100%;border-collapse:collapse;min-width:750px;font-size:.8rem;}
    th,td{padding:8px 6px;border-bottom:1px solid #e5e7eb;text-align:center;}
    th{
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;font-weight:800;font-size:.78rem;white-space:nowrap;
    }
    .lab-table th{background:linear-gradient(135deg,var(--lab-color),var(--lab-dark));}
    tbody tr:nth-child(even){background:#f9fafb;}
    tbody tr:hover{background:#ecfdf5;}
    td.text-right{text-align:right;}

    .report-header{
      background:linear-gradient(135deg,#14532d,#166534);
      color:#fff;padding:14px 16px;border-radius:10px;
      margin-bottom:18px;text-align:center;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
      border:1px solid rgba(255,255,255,.2);
    }
    .report-header h2{font-size:1.4rem;margin-bottom:10px;font-weight:800;text-shadow:1px 1px 2px rgba(0,0,0,.18);}
    .report-header .ministry{font-size:1.05rem;font-weight:700;margin-bottom:4px;}
    .report-header .program-title{font-size:1.25rem;font-weight:800;margin-top:8px;padding:8px 12px;background:rgba(255,255,255,.12);border-radius:8px;display:inline-block;}

    .toast{
      position:fixed;top:90px;left:50%;transform:translateX(-50%);
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;padding:9px 14px;border-radius:999px;
      font-size:.85rem;font-weight:700;box-shadow:0 8px 20px rgba(15,118,110,.4);
      z-index:2000;max-width:90%;text-align:center;
    }
    .toast.warn{background:linear-gradient(135deg,#facc15,#eab308);color:#111827;}
    .toast.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);}

    .site-footer{background:linear-gradient(135deg,var(--primary),var(--dark));color:#fff;padding:15px;text-align:center;box-shadow:0 -4px 20px rgba(0,0,0,.15);margin-top:30px;}
    .site-footer p{margin:5px 0;font-size:14px;}

    #back-btn{
      position:fixed;top:20px;right:20px;z-index:1000;
      background:var(--primary);color:white;border:none;
      padding:10px 15px;border-radius:5px;cursor:pointer;
      font-family:'Tajawal',sans-serif;box-shadow:0 2px 10px rgba(0,0,0,.2);
      display:none;
    }

    @media (max-width:768px){
      .cards-container{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));}
      .header-text h1{font-size:1.5rem;}
      .card-page{padding:18px;}
      .report-header{padding:15px;}
      .report-header h2{font-size:1.3rem;}
    }
    @media (max-width:480px){
      .cards-container{grid-template-columns:1fr;}
      .header-text h1{font-size:1.3rem;}
      .report-header h2{font-size:1.15rem;}
    }
  </style>
</head>

<body>

<header class="header-logo">
  <div class="wrap">
    <img src="https://raw.githubusercontent.com/omymh/school26/main/26.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…" crossorigin="anonymous">
    <div class="header-text">
      <h1>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h1>
      <p>Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</p>
    </div>
    <div class="quran-verse">ï´¿ ÙˆÙÙ‚ÙÙ„Ù’ Ø±ÙØ¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ ï´¾</div>
  </div>
</header>

<nav>
  <div class="nav-container">
    <div class="nav-title">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</div>
    <div class="cards-container">
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/R1397/', 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±')">
        <div class="icon">ğŸ—“ï¸</div>
        <div class="title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        <div class="subtitle"><span>Ø§Ù„ÙŠÙˆÙ…ÙŠ</span><span>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span><span>Ø§Ù„Ø´Ù‡Ø±ÙŠ</span></div>
      </div>

      <div class="card featured" onclick="window.loadLocal && window.loadLocal('wait')">
        <div class="icon">ğŸ•’</div>
        <div class="title">Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
      </div>

      <div class="card labs" onclick="window.loadLocal && window.loadLocal('lab')">
        <div class="icon">ğŸ”¬</div>
        <div class="title">Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
      </div>

      <div class="card featured" onclick="window.loadLocal && window.loadLocal('general')">
        <div class="icon">ğŸ“„</div>
        <div class="title">ØªÙ‚Ø±ÙŠØ± Ø¹Ø§Ù…</div>
        <div class="subtitle"><span>ÙŠÙˆÙ…ÙŠ</span><span>Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span><span>Ø´Ù‡Ø±ÙŠ</span></div>
      </div>

      <!-- Ø¨Ø§Ù‚ÙŠ Ø±ÙˆØ§Ø¨Ø·Ùƒ ÙƒÙ…Ø§ Ù‡ÙŠ -->
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/A1397/', 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ')">
        <div class="icon">ğŸŒŸ</div>
        <div class="title">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/AC1397/', 'Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù„Ø§ØµÙÙŠØ©')">
        <div class="icon">ğŸ§©</div>
        <div class="title">Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù„Ø§ØµÙÙŠØ©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/Trace1397/', 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©')">
        <div class="icon">ğŸ“‹</div>
        <div class="title">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/L1397/', 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±')">
        <div class="icon">ğŸ“</div>
        <div class="title">Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/T1397/', 'Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ')">
        <div class="icon">ğŸ“</div>
        <div class="title">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/V1397/', 'ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª')">
        <div class="icon">ğŸ“</div>
        <div class="title">ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/P1397/', 'Ø®Ø±ÙŠØ·Ø© Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù‘Ù…')">
        <div class="icon">ğŸ—ºï¸</div>
        <div class="title">Ø®Ø±ÙŠØ·Ø© Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù‘Ù…</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/PLC1397/', 'Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠØ©')">
        <div class="icon">ğŸ“‘</div>
        <div class="title">Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/D1397/', 'Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµØ­Ù‘ÙŠ')">
        <div class="icon">âš•ï¸</div>
        <div class="title">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµØ­Ù‘ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/S1397/', 'Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù†Ø´Ø·')">
        <div class="icon">â™Ÿ</div>
        <div class="title">Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù†Ø´Ø·</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/LessonA1397/', 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠ')">
        <div class="icon">ğŸ“š</div>
        <div class="title">Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/Warshah1397/', 'ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„')">
        <div class="icon">ğŸ› ï¸</div>
        <div class="title">ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„</div>
      </div>
    </div>
  </div>
</nav>

<main id="local-pages">

  <!-- Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª -->
  <section id="lab-section" class="card-page" style="display:none;">
    <div class="report-header">
      <h2>ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
      <div class="ministry">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="program-title">Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
    </div>

    <p class="lab-intro">Ø³Ø¬Ù„ÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ ÙˆØ§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</p>

    <form id="labForm" class="form lab-form" onsubmit="return false;">
      <div class="grid-3">
        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø© *
          <input class="input" id="labProgram" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ùˆ Ø§Ù„ØªØ¬Ø±Ø¨Ø©">
        </label>
        <label>Ø§Ù„Ù…Ù†ÙØ°Ø© *
          <input class="input" id="labExecutor" required placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ÙØ°Ø©">
        </label>
        <label>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ° *
          <input class="input" id="labLocation" required placeholder="Ù…ÙƒØ§Ù† ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
        </label>
      </div>

      <div class="grid-3">
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ† *
          <input class="input" id="labTargetCount" type="number" min="1" required placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†">
        </label>
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ° (Ù‡Ø¬Ø±ÙŠ) *
          <input class="input" id="labDate" required placeholder="Ù…Ø«Ø§Ù„: 1447/1/13">
        </label>
        <div></div>
      </div>

      <label>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ† *
        <textarea class="input" id="labBeneficiaries" required placeholder="Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø© (Ù…Ø«Ø§Ù„: Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ØŒ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙ…...)"></textarea>
      </label>

      <label>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù *
        <textarea class="input" id="labGoals" required placeholder="Ø§ÙƒØªØ¨ÙŠ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ùˆ Ø§Ù„ØªØ¬Ø±Ø¨Ø©..."></textarea>
      </label>

      <label>Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ (ØµÙˆØ±) â€” Ø­Ø¯Ù‡Ø§ 4 *
        <input class="input" id="labEvidence" type="file" accept="image/*" multiple required>
        <small style="font-weight:400;color:#6b7280;margin-top:2px;">Ø§Ø®ØªØ§Ø±ÙŠ Ø­ØªÙ‰ 4 ØµÙˆØ± ÙÙ‚Ø·.</small>
      </label>

      <div class="actions">
        <button class="btn" type="button" id="saveLab">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="btn" type="button" id="exportLabs">ØªØµØ¯ÙŠØ± ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª (PDF/Ø·Ø¨Ø§Ø¹Ø©)</button>
        <button class="btn danger" type="button" id="clearLabs">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
      </div>
    </form>

    <h3 style="margin-top:20px;margin-bottom:8px;font-size:1.05rem;color:var(--lab-dark);font-weight:800;border-right:4px solid var(--lab-color);padding-right:8px;">
      Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
    </h3>

    <div class="table-wrap">
      <table class="lab-table">
        <thead>
          <tr>
            <th>Ù…</th>
            <th>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø©</th>
            <th>Ø§Ù„Ù…Ù†ÙØ°Ø©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†</th>
            <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</th>
            <th>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</th>
            <th>Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="labsBody"></tbody>
      </table>
    </div>
  </section>

</main>

<div id="iframe-container">
  <iframe id="content-frame" src="about:blank"></iframe>
</div>

<footer class="site-footer">
  <p>Ù†Ø¸Ø§Ù… Ø¯Ø§Ø®Ù„ÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</p>
</footer>

<button id="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<script>
  // =======================
  // Toast
  // =======================
  function showToast(msg,type){
    type = type || '';
    const t=document.createElement('div');
    t.className='toast'+(type?' '+type:'');
    t.textContent=msg;
    document.body.appendChild(t);
    setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity .25s';},1400);
    setTimeout(()=>{t.remove();},1900);
  }

  function escapeHtml(text){
    if(!text) return '';
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  // =======================
  // Navigation (ÙƒÙ…Ø§ Ø¹Ù†Ø¯Ùƒ)
  // =======================
  function loadInIframe(url,title){
    const iframeContainer=document.getElementById('iframe-container');
    const iframe=document.getElementById('content-frame');
    const nav=document.querySelector('nav');
    const localPages=document.getElementById('local-pages');
    const backBtn=document.getElementById('back-btn');

    document.title=(title||'ØªÙ‚Ø±ÙŠØ±')+' - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';

    localPages.style.display='none';
    document.getElementById('lab-section').style.display='none';

    iframe.src=url;
    iframeContainer.style.display='block';
    iframeContainer.scrollIntoView({behavior:'smooth'});
    nav.style.display='block';
    backBtn.style.display='block';

    backBtn.onclick=function(){
      iframeContainer.style.display='none';
      iframe.src='about:blank';
      nav.style.display='block';
      document.title='Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
      backBtn.style.display='none';
      window.scrollTo({top:0,behavior:'smooth'});
    };
  }

  window.loadLocal = function(which){
    const iframeContainer=document.getElementById('iframe-container');
    const nav=document.querySelector('nav');
    const localPages=document.getElementById('local-pages');
    const backBtn=document.getElementById('back-btn');

    iframeContainer.style.display='none';
    document.getElementById('content-frame').src='about:blank';

    localPages.style.display='block';
    document.getElementById('lab-section').style.display = which==='lab' ? 'block' : 'none';

    document.title=(which==='lab'?'Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª':'Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©')+' - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
    nav.style.display='block';
    backBtn.style.display='block';
    localPages.scrollIntoView({behavior:'smooth'});

    backBtn.onclick=function(){
      localPages.style.display='none';
      document.getElementById('lab-section').style.display='none';
      document.title='Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
      backBtn.style.display='none';
      window.scrollTo({top:0,behavior:'smooth'});
    };
  }

  // =======================
  // LABS: Storage
  // =======================
  let labExperiments=[];

  function loadLab(){
    try{
      const saved=localStorage.getItem('w26_lab_experiments');
      if(saved) labExperiments=JSON.parse(saved)||[];
    }catch(e){
      labExperiments=[];
    }
    renderLab();
  }

  function saveLabToStorage(){
    try{
      localStorage.setItem('w26_lab_experiments',JSON.stringify(labExperiments));
      return true;
    }catch(e){
      // ØºØ§Ù„Ø¨Ù‹Ø§ QuotaExceededError
      showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸: Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©. Ù‚Ù„Ù„ÙŠ Ø§Ù„ØµÙˆØ±/Ø§Ø³ØªØ®Ø¯Ù…ÙŠ 4 ØµÙˆØ± ÙÙ‚Ø·.','danger');
      return false;
    }
  }

  function renderLab(){
    const body=document.getElementById('labsBody');
    if(!body) return;
    body.innerHTML='';
    labExperiments.forEach((e,i)=>{
      const evidenceText = (e.evidenceImages && e.evidenceImages.length)
        ? (e.evidenceImages.length + ' ØµÙˆØ±Ø©')
        : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td>
        <td class="text-right">${escapeHtml(e.program)}</td>
        <td>${escapeHtml(e.executor)}</td>
        <td>${escapeHtml(e.date)}</td>
        <td>${escapeHtml(e.targetCount)}</td>
        <td class="text-right">${escapeHtml(e.beneficiaries)}</td>
        <td class="text-right">${escapeHtml(e.goals || '')}</td>
        <td>${escapeHtml(evidenceText)}</td>
        <td>
          <button class="btn danger"
            style="width:auto;padding:4px 8px;font-size:.75rem;border-radius:999px;box-shadow:none;"
            onclick="deleteLab(${i})">Ø­Ø°Ù</button>
        </td>`;
      body.appendChild(tr);
    });
  }

  window.deleteLab = function(i){
    if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ')) return;
    labExperiments.splice(i,1);
    saveLabToStorage();
    renderLab();
    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
  }

  // =======================
  // LABS: Image compress (Ø­Ù„ Ø¬Ø°Ø±ÙŠ Ù„ØªØ¹Ø·Ù„ Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ iPhone)
  // =======================
  function compressImageToDataURL(file, maxW=1280, maxH=1280, quality=0.82){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onerror = () => reject(new Error('FileReader error'));
      reader.onload = () => {
        const img = new Image();
        img.onerror = () => reject(new Error('Image decode error'));
        img.onload = () => {
          let w = img.width, h = img.height;
          const ratio = Math.min(maxW / w, maxH / h, 1);
          w = Math.round(w * ratio);
          h = Math.round(h * ratio);

          const canvas = document.createElement('canvas');
          canvas.width = w;
          canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, w, h);

          // JPEG Ø£ØµØºØ± Ø¨ÙƒØ«ÙŠØ± Ù…Ù† PNG
          const dataURL = canvas.toDataURL('image/jpeg', quality);
          resolve(dataURL);
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });
  }

  // =======================
  // LABS: Save
  // =======================
  function initLabForm(){
    const saveBtn = document.getElementById('saveLab');
    const exportBtn = document.getElementById('exportLabs');
    const clearBtn = document.getElementById('clearLabs');

    saveBtn.addEventListener('click', async ()=>{
      const program=document.getElementById('labProgram').value.trim();
      const executor=document.getElementById('labExecutor').value.trim();
      const location=document.getElementById('labLocation').value.trim();
      const targetCount=document.getElementById('labTargetCount').value.trim();
      const date=document.getElementById('labDate').value.trim();
      const beneficiaries=document.getElementById('labBeneficiaries').value.trim();
      const goals=document.getElementById('labGoals').value.trim();
      const evidenceInput=document.getElementById('labEvidence');
      const files = evidenceInput.files ? Array.from(evidenceInput.files) : [];

      if(!program||!executor||!location||!targetCount||!date||!beneficiaries||!goals||files.length===0){
        showToast('Ø£ÙƒÙ…Ù„ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ ØµÙˆØ± Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯','warn');
        return;
      }

      if(files.length > 4){
        showToast('Ù…Ø³Ù…ÙˆØ­ 4 ØµÙˆØ± ÙÙ‚Ø· Ù„Ù„Ø´ÙˆØ§Ù‡Ø¯','warn');
        return;
      }

      saveBtn.disabled = true;
      saveBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

      try{
        // Ø¶ØºØ· Ø§Ù„ØµÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† (ÙŠØ­Ù…ÙŠ Ù…Ù† ØªØ¹Ø·Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ iPhone)
        const evidenceImages = [];
        for(const f of files){
          const data = await compressImageToDataURL(f, 1280, 1280, 0.82);
          evidenceImages.push(data);
        }

        labExperiments.push({
          program, executor, location, targetCount, date,
          beneficiaries, goals,
          evidenceImages
        });

        const ok = saveLabToStorage();
        if(!ok){
          // Ø±Ø¬Ù‘Ø¹Ù†Ø§ Ø¢Ø®Ø± Ø¹Ù†ØµØ± Ù„Ø£Ù†Ù‡ Ù…Ø§ Ø§Ù†Ø­ÙØ¸
          labExperiments.pop();
          return;
        }

        renderLab();
        document.getElementById('labForm').reset();
        showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
      }catch(err){
        showToast('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±)','danger');
      }finally{
        saveBtn.disabled = false;
        saveBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
      }
    });

    clearBtn.addEventListener('click', ()=>{
      if(!labExperiments.length){
        showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');
        return;
      }
      if(!confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§ØªØŸ')) return;
      labExperiments=[];
      saveLabToStorage();
      renderLab();
      showToast('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');
    });

    // âœ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ PDF Ø¨Ø¯Ù„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
    exportBtn.addEventListener('click', ()=>{
      if(!labExperiments.length){
        showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');
        return;
      }
      exportLabsByPrint();
    });
  }

  // =======================
  // LABS: Export by PRINT (Ø­Ù„ Ø¬Ø°Ø±ÙŠ Ù„Ø´Ø§Ø´Ø© Ø³ÙˆØ¯Ø§Ø¡ + Ø®Ø· Ù…ØªØ¯Ø§Ø®Ù„)
  // =======================
  function exportLabsByPrint(){
    const logoUrl = "https://raw.githubusercontent.com/omymh/school26/main/26.png";

    const pagesHtml = labExperiments.map((exp, idx)=>{
      const imgs = (exp.evidenceImages || []).slice(0,4).map(src=>{
        return `<div class="imgBox"><img src="${src}" alt="Ø´Ø§Ù‡Ø¯"></div>`;
      }).join('');

      return `
        <section class="page">
          <div class="head">
            <img class="logo" src="${logoUrl}" alt="header">
            <div class="title1">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
            <div class="title2">ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬ â€“ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
            <div class="program"><span>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø©:</span> <b>${escapeHtml(exp.program)}</b></div>
          </div>

          <div class="box">
            <div class="row"><span class="k">Ø§Ù„Ù…Ù†ÙØ°Ø©:</span><span class="v">${escapeHtml(exp.executor)}</span></div>
            <div class="row"><span class="k">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ°:</span><span class="v">${escapeHtml(exp.location)}</span></div>
            <div class="row"><span class="k">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†:</span><span class="v">${escapeHtml(exp.targetCount)}</span></div>

            <div class="row col">
              <span class="k">Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†:</span>
              <div class="v pre">${escapeHtml(exp.beneficiaries)}</div>
            </div>

            <div class="row col">
              <span class="k">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:</span>
              <div class="v pre">${escapeHtml(exp.goals)}</div>
            </div>

            <div class="row col">
              <span class="k">Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ (ØµÙˆØ±) â€” Ø­Ø¯Ù‡Ø§ 4:</span>
              <div class="imgs">${imgs || '<div class="noimg">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</div>'}</div>
            </div>

            <div class="row"><span class="k">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°:</span><span class="v">${escapeHtml(exp.date)} Ù‡Ù€</span></div>
          </div>

          <div class="sign">
            <div class="sigBox">
              <div class="sigTitle">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
              <div class="sigName">Ø£Ù…Ø§Ù†ÙŠ Ø¢Ù„ Ø¹Ø¨Ø´Ø§Ù†</div>
            </div>
          </div>
        </section>
      `;
    }).join('');

    const html = `
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª - Ø·Ø¨Ø§Ø¹Ø©</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Tajawal', system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    color:#0f172a;
    background:#fff;
    direction:rtl;
  }
  .page{
    padding:18mm 14mm;
    page-break-after:always;
  }
  .head{text-align:center;margin-bottom:12px}
  .logo{width:100%;height:22mm;object-fit:contain;margin-bottom:6px}
  .title1{font-weight:800;font-size:14px;margin:2px 0}
  .title2{font-weight:900;font-size:16px;margin:2px 0}
  .program{margin-top:8px;font-size:14px;font-weight:700}
  .box{
    border:2px solid #bbf7d0;
    border-radius:12px;
    padding:12px 10px;
    background:#f8fffb;
  }
  .row{display:flex;gap:10px;align-items:flex-start;line-height:1.9;margin:4px 0}
  .row.col{display:block}
  .k{min-width:120px;font-weight:800}
  .v{font-weight:500}
  .pre{
    white-space:pre-wrap;
    word-break:break-word;
    direction:rtl;
    unicode-bidi:plaintext;
    padding:6px 8px;
    background:#fff;
    border:1px solid #d1fae5;
    border-radius:10px;
    margin-top:6px;
  }
  .imgs{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .imgBox{width:42mm;height:28mm;border:1px solid #bbf7d0;border-radius:10px;overflow:hidden;background:#fff}
  .imgBox img{width:100%;height:100%;object-fit:cover}
  .noimg{font-size:12px;color:#475569}
  .sign{
    margin-top:14mm;
    border-top:1px solid #bbf7d0;
    padding-top:6mm;
    direction:ltr;
    display:flex;
    justify-content:flex-start;
  }
  .sigBox{text-align:left}
  .sigTitle{font-weight:800;color:#047857;font-size:13px}
  .sigName{font-weight:600;color:#047857;font-size:13px}

  @media print{
    body{background:#fff}
    .page{page-break-after:always}
  }
</style>
</head>
<body>
${pagesHtml}
<script>
  // Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø®Ø· Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Ù…Ù‡Ù… Ø¹Ù„Ù‰ iPhone)
  async function waitForAssets(){
    try{
      if(document.fonts && document.fonts.ready) await document.fonts.ready;
    }catch(e){}
    const imgs = Array.from(document.images || []);
    await Promise.all(imgs.map(img => img.complete ? Promise.resolve() : new Promise(res=>{
      img.onload = res; img.onerror = res;
    })));
  }
  (async ()=>{
    await waitForAssets();
    window.focus();
    window.print();
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ Ù†ØºÙ„Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø£Ù† iOS Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ ÙŠÙ…Ù†Ø¹
  })();
</script>
</body>
</html>
    `.trim();

    const w = window.open('', '_blank');
    if(!w){
      showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙØ¹Ù‘Ù„ÙŠ Pop-ups Ø«Ù… Ø£Ø¹ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.','danger');
      return;
    }
    w.document.open();
    w.document.write(html);
    w.document.close();
  }

  // =======================
  // Init
  // =======================
  function initializeApp(){
    try{
      loadLab();
      initLabForm();
    }catch(e){
      showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©. Ø§ÙØªØ­ÙŠ Console Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø³Ø¨Ø¨.','danger');
    }
  }
  document.addEventListener('DOMContentLoaded', initializeApp);
</script>

</body>
</html>

